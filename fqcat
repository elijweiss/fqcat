#!/bin/bash
# Display fastq with quality scores in color
# (Green for high, red for low)

fastq=$1

declare -A phred_colors=(
["'!'"]="196"
["'\"'"]="196"
["'#'"]="196"
["'$'"]="202"
["'%'"]="202"
["'&'"]="202"
["'''"]="202"
["'('"]="202"
["')'"]="208"
["'*'"]="208"
["'+'"]="208"
["','"]="208"
["'-'"]="208"
["'.'"]="214"
["'/'"]="214"
["'0'"]="214"
["'1'"]="214"
["'2'"]="214"
["'3'"]="220"
["'4'"]="220"
["'5'"]="220"
["'6'"]="220"
["'7'"]="220"
["'8'"]="226"
["'9'"]="226"
["':'"]="226"
["';'"]="226"
["'<'"]="226"
["'='"]="190"
["'>'"]="190"
["'?'"]="190"
["'@'"]="190"
["'A'"]="190"
["'B'"]="118"
["'C'"]="118"
["'D'"]="118"
["'E'"]="118"
["'F'"]="118"
["'G'"]="048"
["'H'"]="048"
["'I'"]="048"
["'J'"]="048"
["'K'"]="048"
)

while read -r l1; do
  read -r l2
  read -r l3
  read -r l4

  echo -e "$l1"
  echo -e "\e[38;5;27m$l2\e[0m"
  echo -e "$l3"

  qual=""
  for (( c=0; c<${#l4}; c++ )); do
    char=${l4:$c:1}
    color=${phred_colors[\'$char\']}
    qual=$qual"\e[38;5;${color}m$char" # for bg color, use 48 instead of 38
  done
  qual=$qual"\e[0m"
  echo -e $qual
done < "${fastq:-/dev/stdin}"
